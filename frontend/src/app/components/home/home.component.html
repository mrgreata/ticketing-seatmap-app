<main *ngIf="!isAuthenticated" class="hero d-flex flex-column justify-content-center align-items-center text-center mb-5">
  <h1 class="display-4 mb-4">Willkommen bei Ticketline!</h1>
  <p class="lead mb-4">Entdecken Sie die besten Veranstaltungen und bleiben Sie mit unseren News auf dem Laufenden.</p>
  <div class="d-flex flex-column flex-sm-row gap-3">
    <button class="btn btn-dark btn-lg px-4 py-2" routerLink="/login">
      <i class="bi bi-box-arrow-in-right me-2"></i>Login
    </button>
    <button class="btn btn-outline-dark btn-lg px-4 py-2" routerLink="/registration">
      <i class="bi bi-person-plus me-2"></i>Registrieren
    </button>
  </div>
</main>

<div class="container mt-4">
  <div *ngIf="isAuthenticated && userName" class="text-center mb-5">
    <h1 class="fw-bold">Willkommen, {{ userName }}!</h1>
    <p class="text-muted">Hier sind die neuesten News und Veranstaltungen für Sie</p>
  </div>

  <!-- Top Ten Events Section -->
  <section class="mb-5">
    <div class="top-ten-card">
      <div class="top-ten-header" (click)="toggleTopTen()">
        <h2 class="fw-bold m-0">Top Ten Events</h2>
        <span class="toggle-icon">{{ showTopTen ? '−' : '+' }}</span>
      </div>

      <div class="top-ten-body" *ngIf="showTopTen">
        <div class="top-ten-filters">
          <select class="form-select" [(ngModel)]="topTenMonth" (change)="onTopTenFilterChange()">
            <option [value]="1">Jänner</option>
            <option [value]="2">Februar</option>
            <option [value]="3">März</option>
            <option [value]="4">April</option>
            <option [value]="5">Mai</option>
            <option [value]="6">Juni</option>
            <option [value]="7">Juli</option>
            <option [value]="8">August</option>
            <option [value]="9">September</option>
            <option [value]="10">Oktober</option>
            <option [value]="11">November</option>
            <option [value]="12">Dezember</option>
          </select>

          <input
            type="number"
            class="form-control"
            [(ngModel)]="topTenYear"
            (change)="onTopTenFilterChange()"
            placeholder="Jahr"
            min="2000"
            max="2100"
          />

          <select class="form-select" [(ngModel)]="topTenType" (change)="onTopTenFilterChange()">
            <option value="">Alle Typen</option>
            <option *ngFor="let type of eventTypes" [value]="type">{{ type }}</option>
          </select>
        </div>

        <div class="top-ten-list" *ngIf="topTenEvents.length > 0">
          <div class="top-ten-item" *ngFor="let event of topTenEvents">
            <div class="event-info">
              <span class="event-rank">{{ topTenEvents.indexOf(event) + 1 }}</span>
              <span class="event-title">{{ event.title }}</span>
              <span class="event-tickets">{{ event.ticketsSold }} verkaufte Tickets</span>
            </div>
            <div class="bar-container">
              <div class="bar" [style.width.%]="getBarWidth(event.ticketsSold)"></div>
            </div>
            <button
              class="btn btn-saalplan"
              (click)="openSeatmapFromTopTen(event.eventId)">
              SAALPLAN
            </button>
          </div>
        </div>

        <div *ngIf="topTenEvents.length === 0" class="alert alert-info m-3">
          Keine Top Ten Daten für diesen Zeitraum verfügbar.
        </div>
      </div>
    </div>
  </section>

  <!-- News -->
  <section class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="fw-bold">Aktuelle News</h2>
      <a [routerLink]="['/news/home']" class="btn btn-outline-primary">
        Alle News anzeigen
      </a>
    </div>

    <div *ngIf="isLoadingNews" class="text-center my-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Laden...</span>
      </div>
    </div>

    <div *ngIf="!isLoadingNews && errorNews" class="alert alert-warning">
      {{ errorNews }}
    </div>

    <div *ngIf="!isLoadingNews && news.length > 0">
      <div class="row g-3">
        <div class="col-md-3" *ngFor="let newsItem of news">
          <div class="news-card">
            <!-- Date and Title Row -->
            <div class="news-card-header">
              <div class="news-card-header-content">
                <!-- Date Section -->
                <div class="news-card-date">
                  <div class="news-card-month">
                    {{ getMonthFromDate(newsItem.publishedAt) }}
                  </div>
                  <div class="news-card-day">
                    {{ getDayFromDate(newsItem.publishedAt) }}
                  </div>
                </div>

                <!-- Title Section -->
                <div class="news-card-title-wrapper">
                  <div class="news-card-title">
                    {{ newsItem.title }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Line -->
            <div class="news-card-divider-wrapper">
              <div class="news-card-divider"></div>
            </div>

            <!-- Image -->
            <div class="news-card-image-wrapper">
              <img
                class="news-card-image"
                [src]="getNewsImageUrl(newsItem.id)"
                (error)="onImageError($event)"
                [alt]="newsItem.title"
              />
            </div>

            <!-- Summary -->
            <div class="news-card-summary">
              <div class="news-card-summary-text">
                {{ newsItem.summary }}
              </div>
            </div>

            <!-- Details Button -->
            <div class="news-card-footer">
              <a [routerLink]="['/news/detail', newsItem.id]" class="news-card-button">
                <span class="news-card-button-text">Details</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoadingNews && news.length === 0" class="alert alert-info">
      Derzeit sind keine News verfügbar.
    </div>
  </section>

  <!-- Events -->
  <section class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="fw-bold">Aktuelle Veranstaltungen</h2>
      <a [routerLink]="['/events']" class="btn btn-outline-primary">
        Alle Veranstaltungen anzeigen
      </a>
    </div>

    <div *ngIf="isLoadingEvents" class="text-center my-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Laden...</span>
      </div>
    </div>

    <div *ngIf="!isLoadingEvents && errorEvents" class="alert alert-warning">
      {{ errorEvents }}
    </div>

    <div *ngIf="!isLoadingEvents && events.length > 0">
      <div class="row g-3">
        <div class="col-md-3" *ngFor="let event of events">
          <div class="event-card">
            <div class="event-card-header">
              <div class="event-card-header-content">
                <div class="event-card-date">
                  <div class="event-card-month">{{ getEventMonth(event.dateTime) }}</div>
                  <div class="event-card-day">{{ getEventDay(event.dateTime) }}</div>
                </div>
                <div class="event-card-title-wrapper">
                  <div class="event-card-title">{{ event.title }}</div>
                </div>
              </div>
            </div>

            <div class="event-card-divider-wrapper">
              <div class="event-card-divider"></div>
            </div>

            <div class="event-card-image-wrapper">
              <img
                class="event-card-image"
                [src]="getEventImageUrl(event)"
                [alt]="event.title"
              />
            </div>

            <div class="event-card-details">
              <div class="event-card-details-text">
                {{ event.type }} | {{ event.durationMinutes }} Min | {{ formatEventDate(event.dateTime) }}<br>
                <span class="location-full">
                  {{ event.locationName }}<span *ngIf="event.locationCity">, {{ event.locationCity }}</span>
                </span>
              </div>

              <div class="event-description-divider"></div>

              <div class="event-description" *ngIf="event.description; else noDescription">
                {{ event.description.length > 80 ? (event.description.substring(0, 80) + '...') : event.description }}
              </div>

              <ng-template #noDescription>
                <div class="event-description event-description-empty">
                  <span class="text-muted">Keine Beschreibung verfügbar</span>
                </div>
              </ng-template>
            </div>

            <div class="event-card-footer">
              <div class="event-card-actions">
                <div class="event-price" *ngIf="event.minPrice">
                  <span class="price-label">ab</span>
                  <span class="price-value">{{ (event.minPrice / 100) | number:'1.2-2' }}€</span>
                </div>

                <a [routerLink]="['/events', event.id]" class="event-card-button">
                  <span class="event-card-button-text">Details</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoadingEvents && events.length === 0" class="alert alert-info">
      Derzeit sind keine Veranstaltungen verfügbar.
    </div>
  </section>
</div>
